<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Androidoauth2googleapijavaclient : The goal of this sample project is to show you how you can do OAuth2 from an Android application using the Google OAuth Client Library for Java." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Android OAuth2 using Google OAuth Client Library for Java</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ddewaele/AndroidOauth2GoogleApiJavaClient">View on GitHub</a>
<div id="followme_banner" >
<a  href="https://twitter.com/ddewaele" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @ddewaele</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

          <h1 id="project_title">Android OAuth2</h1>
          <h2 id="project_tagline">using Google OAuth Client Library for Java.</h2>

            <section id="downloads">

<a href="https://twitter.com/share" class="twitter-share-button" data-via="ddewaele">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


              <a class="zip_download_link" href="https://github.com/ddewaele/AndroidOauth2GoogleApiJavaClient/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ddewaele/AndroidOauth2GoogleApiJavaClient/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
	<h2 id='introduction'>Introduction</h2>

<p>The goal of this sample project is to show you how you can do OAuth2 from an Android application using the <a href='https://code.google.com/p/google-oauth-java-client/'>Google OAuth Client Library for Java</a>.</p>

<p>The sample application allows you to access data from the following OAuth2 providers</p>

<ul>
<li>Foursquare (using the Google OAuth Client Library for Java to access a non-Google API).</li>

<li>Google Tasks (using the Google OAuth Client Library for Java to access this Google API).</li>

<li>Google Plus (using Google APIs Client Library for Java, offering a higher level abstraction for interacting with Google APIs)</li>
</ul>

<h2 id='legacy_github_repo__blog_post'>Legacy github repo / blog post</h2>

<p>This repository has recently been updated to use a new version of the Google OAuth libraries, and now also includes the Foursquare flow.</p>

<p>The original blog post for the original github repository can be found <a href='http://blog.doityourselfandroid.com/2011/08/06/oauth-2-0-flow-android/'>here</a>.</p>

<p>Note that some of the code samples in the article are now out-of-date due to the new version of the Google OAuth library. I&#8217;ll write up a new blog post as soon as I can find the time.</p>

<h2 id='google_projects_for_doing_oauth2'>Google projects for doing OAuth2</h2>

<p>The sample application uses 3 projects from the Google OAuth2 client library family.</p>

<ul>
<li><a href='https://code.google.com/p/google-oauth-java-client/'>Google OAuth Client Library for Java</a></li>

<li><a href='https://code.google.com/p/google-http-java-client/'>Google HTTP Client Library for Java</a></li>

<li><a href='http://code.google.com/p/google-api-java-client/'>Google APIs Client Library for Java</a></li>
</ul>

<p>The last one is optional and is only really needed when interacting with Google APIs. It offers a higher level abstraction for the Google OAuth2 endpoints. There&#8217;s for example no need to configure authorization and token URLs yourself as all of that is handled by the API. It also comes with a huge set of <a href='https://code.google.com/p/google-api-java-client/wiki/APIs'>client libraries</a> that make it even easier to interact with Google APIs.</p>

<p>These client libraries not only encapsulates the OAuth2 part, but also provide</p>

<ul>
<li>Java wrappers for the data-structures used by the API (ex: the Google Plus client library will have an Activity / Person / Comment objects)</li>

<li>Java wrappers for the actual API itself (ex: the Google Plus client library has a Plus class, allowing easy access to activities, persons and comments).</li>
</ul>

<p>The Google Tasks sample included in the application for example doesn&#8217;t use the Google APIs Client library, but shows you how to configure the Google OAuth2 endpoints manually, and execute the API calls using raw HTTP (without using a client library).</p>

<p>Although the Google APIs Client Library for Java primarily target Google APIs, they can also be used to interact with non-Google Oauth2 providers like Foursquare.</p>

<h2 id='project_setup'>Project setup</h2>

<p>This project is built using the <a href='http://rgladwell.github.io/m2e-android/index.html'>m2e-android plugin</a> to handle its external dependencies.</p>

<p>When using Eclipse ADT, it assumes that the following components are installed :</p>

<ul>
<li>Eclipse Market Client</li>

<li>m2e-android plugin</li>
</ul>

<p>If you don&#8217;t have the Eclipse Marker Client installed, you can install it by clicking on</p>

<p><code>Help → Install new Software → Switch to the Juno Repository → General Purpose Tools → Marketplace Client</code></p>

<p>Once you have the Eclipse Market Client installed, you can proceed to install the m2e-android plugin</p>

<p><code>Help -&gt; Eclipse Marketplace... and search for &quot;android m2e&quot;.</code></p>

<p>More instructions can be found on the <a href='http://rgladwell.github.io/m2e-android/index.html'>m2e-android plugin</a> site.</p>

<h2 id='project_configuration'>Project configuration</h2>

<p>The OAuth2 connection params are defined in the <code>com.ecs.android.sample.oauth2.OAuth2Params</code> class.</p>

<pre><code>GOOGLE_PLUS(&quot;&quot;,&quot;&quot;,&quot;https://accounts.google.com/o/oauth2/token&quot;,&quot;https://accounts.google.com/o/oauth2/auth&quot;,BearerToken.authorizationHeaderAccessMethod(),PlusScopes.PLUS_ME,&quot;http://localhost&quot;,&quot;plus&quot;,&quot;https://www.googleapis.com/plus/v1/people/me/activities/public&quot;),
GOOGLE_TASKS_OAUTH2(&quot;&quot;,&quot;&quot;,&quot;https://accounts.google.com/o/oauth2/token&quot;,&quot;https://accounts.google.com/o/oauth2/auth&quot;,BearerToken.authorizationHeaderAccessMethod(),&quot;https://www.googleapis.com/auth/tasks&quot;,&quot;http://localhost&quot;,&quot;tasks&quot;,&quot;https://www.googleapis.com/tasks/v1/users/@me/lists&quot;),
FOURSQUARE_OAUTH2(&quot;&quot;,&quot;&quot;,&quot;https://foursquare.com/oauth2/access_token&quot;, &quot;https://foursquare.com/oauth2/authenticate&quot;,FoursquareQueryParameterAccessMethod.getInstance(),&quot;&quot;,&quot;http://localhost&quot;,&quot;foursquare&quot;,&quot;https://api.foursquare.com/v2/users/self/checkins&quot;); </code></pre>

<p>I haven&#8217;t shared my own clientId and clientSecrets here so you&#8217;ll need to provide them yourself (first 2 arguments of the constructor.</p>

<p>If you don&#8217;t provide the clientId and clientSecret you&#8217;ll see the following message on your screen.</p>

<p><img alt='No clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/10_noclientidandsecret.png' /></p>

<p>If you have provided a clientId and clientSecret then you should see this</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/1_intro_screen.png' /></p>

<p>Notice how for each OAuth2 provider we have 3 buttons</p>

<ul>
<li>OAuth2 (starts the oauth2 flow and gets an access token (+ optional refresh token)</li>

<li>API (executes an API call)</li>

<li>Clear (clears the credentials)</li>
</ul>

<p>When you start an OAuth2 flow (ex: the Google flows), you&#8217;ll be invited to login with your Google account</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/2_google_login.png' /></p>

<p>Google will then prompt you to provide access to your application to access the users data.</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/3_google_authorization.png' /></p>

<p>When returning to the application, an API call will be executed on a protected resource from that OAuth2 service provided. The RAW JSON is simply dumped on the screen.</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/4_api_call.png' /></p>

<p>When returning to the intro screen, the application shows the <code>access_token</code> and the time in seconds before it expires. Note that the Google OAuth library handles expired tokens transparently. So when clicking on the API button with an expired token, the API will automatically refresh the token in the background before executing the API call.</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/5_accesstoken.png' /></p>

<p>The same is applicable for non-Google OAuth2 service providers like Foursquare. You also need to login and you also need to authorize the application to access your data.</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/6_foursquare.png' /> <img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/7_foursquare_login.png' /></p>

<p>Note how Foursquare doesn&#8217;t issue a refresh token, but rather a non-expiring access token.</p>

<p><img alt='clientID and secret provided' src='https://dl.dropboxusercontent.com/u/13246619/Blog%20Articles/OAuth2Demo/9_accesstoken2.png' /></p>

<h2 id='project_dependences'>Project dependences</h2>

<p>This project depends on the following libraries. (automatically pulled in when using the m2e-android plugin).</p>

<ul>
<li>commons-logging/commons-logging/1.1.1/commons-logging-1.1.1.jar</li>

<li>org/apache/httpcomponents/httpclient/4.0.1/httpclient-4.0.1.jar</li>

<li>org/apache/httpcomponents/httpcore/4.0.1/httpcore-4.0.1.jar</li>

<li>commons-codec/commons-codec/1.3/commons-codec-1.3.jar</li>

<li>com/google/apis/google-api-services-plus/v1-rev72-1.15.0-rc/google-api-services-plus-v1-rev72-1.15.0-rc.jar</li>

<li>com/google/api-client/google-api-client/1.15.0-rc/google-api-client-1.15.0-rc.jar</li>

<li>com/google/oauth-client/google-oauth-client/1.15.0-rc/google-oauth-client-1.15.0-rc.jar</li>

<li>com/google/http-client/google-http-client-jackson2/1.15.0-rc/google-http-client-jackson2-1.15.0-rc.jar</li>

<li>com/google/http-client/google-http-client/1.15.0-rc/google-http-client-1.15.0-rc.jar</li>

<li>com/google/code/findbugs/jsr305/1.3.9/jsr305-1.3.9.jar</li>

<li>com/fasterxml/jackson/core/jackson-core/2.1.3/jackson-core-2.1.3.jar</li>
</ul>

<h2 id='references'>References</h2>

<ul>
<li><a href='http://rgladwell.github.io/m2e-android/index.html'>m2e-android plugin</a></li>

<li><a href='http://code.google.com/p/google-api-java-client/'>Google APIs Client Library for Java</a></li>

<li><a href='https://code.google.com/p/google-oauth-java-client/'>Google OAuth Client Library for Java</a></li>

<li><a href='https://code.google.com/p/google-http-java-client/'>Google HTTP Client Library for Java</a></li>

<li><a href='https://developers.google.com/oauthplayground'>OAuth2 Playground</a></li>
</ul>
  <hr/>
      <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'androidoauth2googleapijavaclient'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Androidoauth2googleapijavaclient maintained by <a href="https://github.com/ddewaele">ddewaele</a> &nbsp; 

          <a href="https://twitter.com/ddewaele" class="twitter-follow-button" data-show-count="false">Follow @ddewaele</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-43126318-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
